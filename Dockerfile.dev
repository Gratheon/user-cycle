# Development Dockerfile (no build step, uses ts-node-dev via docker-compose)
FROM node:20-alpine

WORKDIR /app

# Ensure dev dependencies are installed
ENV NODE_ENV=development

# Optional: install build tools if native modules are needed later
# RUN apk add --no-cache python3 make g++

# Copy manifests for better caching
COPY package.json package-lock.json* ./

# Install including dev dependencies explicitly (robust against NODE_ENV mismatches)
RUN npm install --include=dev

# Copy tsconfig so tooling can read it even before volume mount
COPY src/config ./src/config
COPY schema.graphql /app/schema.graphql

EXPOSE 4000

CMD npm run dev-in-docker
